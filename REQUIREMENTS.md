# 伊以美战事实时追踪平台 — 需求文档

## 1. 项目概述

### 1.1 背景

2026 年 2 月 28 日，以色列对伊朗发动空袭。用户需要一个能实时展示最新战况的网页平台，以时间线形式呈现军事新闻动态，所有信息来源可追溯。

### 1.2 目标用户

关注中东局势、伊以美军事冲突的中文用户。

### 1.3 产品定位

一个轻量级、实时刷新的军事新闻时间线聚合页面，类似知乎/微博实时战况更新帖的独立网页版。

---

## 2. 核心功能需求

### 2.1 新闻数据获取（P0）

| 编号   | 功能          | 描述                                                                  |
| ------ | ------------- | --------------------------------------------------------------------- |
| F001   | 多源 RSS 聚合 | 从多个免费 RSS 源并行获取军事新闻，无需 API Key                       |
| F002   | 关键词过滤    | 仅保留与伊朗、以色列、美国、战争/军事强相关的内容                     |
| F002.1 | 时间过滤      | 仅保留 **2026-02-28 00:00:00 UTC** 之后发布的新闻，更早的消息完全丢弃 |
| F003   | 内容去重      | 同一事件的不同来源报道自动去重                                        |
| F004   | 定时拉取      | 客户端每 10 秒向服务端请求最新新闻                                    |

### 2.2 页面展示（P0）

| 编号 | 功能         | 描述                                             |
| ---- | ------------ | ------------------------------------------------ |
| F005 | 时间线布局   | 按日期分组、按发布时间倒序排列，最新内容在最上方 |
| F006 | 新闻条目     | 每条包含：精确时间（HH:MM）、内容摘要、来源名称  |
| F007 | 来源可追溯   | 每条新闻标注来源媒体名称，点击可跳转至原文页面   |
| F008 | 倒计时指示器 | 页面顶部/底部固定显示距下次刷新的倒计时（10 秒） |

### 2.3 内容处理（P0）

| 编号 | 功能         | 描述                                                                                                   |
| ---- | ------------ | ------------------------------------------------------------------------------------------------------ |
| F012 | 中文显示     | 页面所有新闻内容（标题、摘要）统一以**中文**显示                                                       |
| F013 | 英文自动翻译 | 英文来源的标题和摘要自动翻译为中文，使用免费翻译方案（`@vitalets/google-translate-api`），无需 API Key |
| F014 | 保留原文信息 | 翻译后的条目保留原始标题/摘要和语言标识，便于用户对照                                                  |

### 2.4 交互功能（P1）

| 编号 | 功能       | 描述                               |
| ---- | ---------- | ---------------------------------- |
| F009 | 手动刷新   | 提供手动刷新按钮，不必等待自动刷新 |
| F010 | 新消息提示 | 有新消息到达时在页面顶部提示       |
| F011 | 响应式适配 | 桌面端与移动端均可正常浏览         |

---

## 3. 数据源定义（免费 RSS）

### 3.1 数据源调研结论

完全弃用付费 API（TianAPI、NewsAPI），改为 **100% 免费 RSS 源**。

**核心优势**：

- ✅ 完全免费，无调用次数/配额限制
- ✅ 无需注册、无需 API Key
- ✅ 每条新闻自带原文链接，来源完全可追溯
- ✅ 多源并行抓取，提高覆盖面和容错能力

### 3.2 RSS 源清单

#### 第一梯队 — Google News 自定义搜索 RSS（推荐核心源）

Google News 支持通过 URL 参数自定义关键词生成 RSS，完全免费、无配额限制、实时聚合全网新闻。

| 源名称                         | RSS URL                                                                                              | 语言 | 说明             |
| ------------------------------ | ---------------------------------------------------------------------------------------------------- | ---- | ---------------- |
| Google News 伊朗以色列（英文） | `https://news.google.com/rss/search?q=Iran+Israel+war+military&hl=en&gl=US&ceid=US:en`               | EN   | 英文军事新闻聚合 |
| Google News 伊朗以色列（中文） | `https://news.google.com/rss/search?q=伊朗+以色列+战争&hl=zh-CN&gl=CN&ceid=CN:zh-Hans`               | ZH   | 中文军事新闻聚合 |
| Google News 中东冲突（英文）   | `https://news.google.com/rss/search?q=Middle+East+conflict+airstrike+missile&hl=en&gl=US&ceid=US:en` | EN   | 中东冲突专项     |

#### 第二梯队 — 国际权威媒体 RSS

| 源名称              | RSS URL                                                                   | 语言 | 更新频率 | 覆盖重点         |
| ------------------- | ------------------------------------------------------------------------- | ---- | -------- | ---------------- |
| BBC 世界新闻        | `https://feeds.bbci.co.uk/news/world/middle_east/rss.xml`                 | EN   | 实时     | 中东地区         |
| Al Jazeera 全站     | `https://www.aljazeera.com/xml/rss/all.xml`                               | EN   | 实时     | 中东深度报道     |
| Reuters 世界新闻    | `https://www.reutersagency.com/feed/?taxonomy=best-topics&post_type=best` | EN   | 实时     | 全球军事         |
| NPR 世界新闻        | `https://feeds.npr.org/1004/rss.xml`                                      | EN   | 实时     | 美国视角国际新闻 |
| DW 德国之声（英文） | `https://rss.dw.com/rdf/rss-en-world`                                     | EN   | 实时     | 国际视角         |

#### 第三梯队 — 军事专业 RSS

| 源名称           | RSS URL                                                               | 语言 | 更新频率 | 覆盖重点       |
| ---------------- | --------------------------------------------------------------------- | ---- | -------- | -------------- |
| Defense News     | `https://www.defensenews.com/arc/outboundfeeds/rss/?outputType=xml`   | EN   | 每日     | 国防装备、战略 |
| Military Times   | `https://www.militarytimes.com/arc/outboundfeeds/rss/?outputType=xml` | EN   | 每日     | 美军动态       |
| Breaking Defense | `https://breakingdefense.com/feed/`                                   | EN   | 每日     | 国防政策分析   |

### 3.3 RSS 源对比分析

| 指标       | 原方案（TianAPI+NewsAPI） | 新方案（纯 RSS）              |
| ---------- | ------------------------- | ----------------------------- |
| 费用       | 付费（100 次/天免费额度） | **完全免费**                  |
| API Key    | 需要注册获取              | **不需要**                    |
| 调用限制   | 100-10000 次/天           | **无限制**                    |
| 数据格式   | JSON                      | XML/RSS（需解析）             |
| 来源可追溯 | 部分                      | **100% 有原文链接**           |
| 中文支持   | 原生中文                  | Google News 中文搜索 + 英文源 |
| 实时性     | 分钟级                    | 实时                          |
| 容错性     | 单源故障即中断            | **多源互备**                  |

---

## 4. 数据结构定义

### 4.1 新闻条目数据模型

```typescript
interface NewsItem {
  id: string; // 唯一标识
  title: string; // 新闻标题（中文，英文源经翻译）
  description: string; // 内容摘要（中文，英文源经翻译）
  originalTitle?: string; // 原始标题（仅英文源保留）
  originalDescription?: string; // 原始摘要（仅英文源保留）
  language: "zh" | "en"; // 原始语言标识
  source: string; // 来源媒体名称（如：BBC News、Al Jazeera）
  sourceUrl: string; // 原文链接（可跳转）
  publishTime: string; // 发布时间 ISO 8601
  imageUrl?: string; // 封面图（可选）
  keywords: string[]; // 命中的关键词列表
}
```

### 4.2 API 响应结构

```typescript
interface NewsApiResponse {
  success: boolean;
  data: NewsItem[];
  total: number;
  fetchedAt: string; // 服务端获取时间
}
```

---

## 5. 展示规范

### 5.1 时间线格式参考（对照用户提供的截图）

```
2026年2月28日

17:17 巴林称美国第五舰队服务中心遭到导弹袭击。
      来源：BBC News [查看原文→]

17:15 沙特发生爆炸。美以轰炸伊拉克。
      来源：Al Jazeera [查看原文→]

17:11 科威特，阿联酋发生爆炸。巴林的美国海军基地发生爆炸
      来源：Reuters [查看原文→]

────────────────────────────────

2026年2月27日

23:45 ...
```

### 5.2 关键展示要素

- **时间**：精确到分钟（HH:MM），按倒序排列
- **内容**：简洁摘要，一到两句话概括核心事件，**统一中文显示**
- **来源**：媒体名称 + 可点击的原文链接
- **日期分隔**：不同日期之间有明显的视觉分隔
- **时间范围**：仅展示 2026 年 2 月 28 日及之后的新闻

---

## 6. 关键词过滤策略

### 6.1 国家/地区关键词

```
伊朗, Iran, 德黑兰, Tehran
以色列, Israel, 特拉维夫, Tel Aviv, 耶路撒冷
美国, USA, United States, 美军, 五角大楼, Pentagon
巴林, 卡塔尔, 阿联酋, 沙特, 科威特, 伊拉克, 叙利亚, 黎巴嫩
```

### 6.2 军事行动关键词

```
导弹, missile, 轰炸, bombing, 空袭, airstrike
袭击, attack, 防空, 拦截, intercept
打击, strike, 爆炸, explosion, 战争, war
军事, military, 冲突, conflict, 战斗, combat
无人机, drone, 核设施, nuclear
```

### 6.3 过滤规则

Google News RSS 源已通过搜索关键词预筛选，但仍需在服务端做二次过滤：

1. **时间过滤**：`publishTime >= 2026-02-28T00:00:00Z`，早于此时间的新闻直接丢弃
2. 包含至少一个**国家/地区关键词**
3. 包含至少一个**军事行动关键词**

对于非 Google News 的通用 RSS 源（BBC、Al Jazeera 等），此二次过滤尤为关键。

---

## 7. 刷新机制

- 客户端每 **10 秒** 向 `/api/news` 发起请求
- 页面显示倒计时（10 → 0），归零时自动刷新并重置
- 服务端对 RSS 源设置 **60 秒内存缓存**，60 秒内复用解析结果，避免频繁抓取
- 支持用户手动点击刷新，立即获取最新数据

---

## 8. 技术约束

| 约束     | 说明                                                   |
| -------- | ------------------------------------------------------ |
| 框架     | Next.js 14+（App Router）                              |
| 语言     | TypeScript                                             |
| 部署     | Vercel（Serverless）                                   |
| 数据源   | 纯免费 RSS，无需 API Key                               |
| RSS 解析 | 使用 `rss-parser` 库解析 XML                           |
| 翻译     | `@vitalets/google-translate-api`（免费，无需 API Key） |

---

## 9. 验收标准

- [ ] 页面能正确展示军事新闻时间线
- [ ] 新闻按时间倒序排列，最新在上
- [ ] **仅展示 2026-02-28 及之后的新闻**
- [ ] **所有新闻标题和摘要以中文显示**
- [ ] **英文来源新闻自动翻译为中文**
- [ ] 每条新闻有明确来源，点击可跳转原文
- [ ] 10 秒自动刷新 + 倒计时显示正常
- [ ] 手动刷新按钮可用
- [ ] 关键词过滤准确，仅展示伊朗/以色列/美国/战争相关内容
- [ ] 桌面端和移动端均可正常显示
- [ ] 可成功部署到 Vercel
- [ ] 无需任何 API Key 即可运行
